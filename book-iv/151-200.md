# 组合数学 - 第4卷: 容斥原理 (151-200)

---

## 151. 容斥原理基础
**题目**: 用容斥原理求1到50中能被2或3整除的整数个数

**解答**:
设 $A$ 为能被2整除的数集，$B$ 为能被3整除的数集

$$|A| = \left\lfloor\frac{50}{2}\right\rfloor = 25, \quad |B| = \left\lfloor\frac{50}{3}\right\rfloor = 16$$

$$|A \cap B| = \left\lfloor\frac{50}{6}\right\rfloor = 8$$ (能被6整除)

由容斥原理：
$$|A \cup B| = |A| + |B| - |A \cap B| = 25 + 16 - 8 = 33$$

**答案**: $\boxed{33}$

---

## 152. 两个集合容斥
**题目**: 某班有40名学生，其中28人会游泳，25人会骑车，10人两项都会。问两项都不会的有多少人？

**解答**:
设会游泳的为集合$A$，会骑车的为集合$B$

$$|A| = 28, \quad |B| = 25, \quad |A \cap B| = 10$$

至少会一项的人数：
$$|A \cup B| = |A| + |B| - |A \cap B| = 28 + 25 - 10 = 43$$

但这超过了总人数40，题目数据有误。按容斥计算，会至少一项的为43人，超过40人，说明题目数据不一致。

若按正确理解，两项都不会的为 $\max(0, 40 - 43) = 0$ 或题目应修正。

假设班级有50人，则两项都不会的有 $50 - 43 = 7$ 人

**答案**: $\boxed{7}$ (假设班级50人)

---

## 153. 容斥原理应用
**题目**: 求1到100中既不被2整除也不被5整除的正整数个数

**解答**:
设 $A$ 为被2整除的数集，$B$ 为被5整除的数集

$$|A| = 50, \quad |B| = 20, \quad |A \cap B| = \left\lfloor\frac{100}{10}\right\rfloor = 10$$

被2或5整除的数：
$$|A \cup B| = 50 + 20 - 10 = 60$$

既不被2也不被5整除的数：
$$100 - 60 = 40$$

**答案**: $\boxed{40}$

---

## 154. 补集容斥
**题目**: 从1到80中随机取一个数，求该数与80互质的概率

**解答**:
$80 = 2^4 \times 5$，所以与80不互质的数是被2或5整除的数

$$|A_2| = 40, \quad |A_5| = 16, \quad |A_2 \cap A_5| = 8$$

$$|A_2 \cup A_5| = 40 + 16 - 8 = 48$$

与80互质的数：$80 - 48 = 32$

概率为 $\frac{32}{80} = \frac{2}{5}$

**答案**: $\boxed{\dfrac{2}{5}}$

---

## 155. 欧拉函数计算
**题目**: 用容斥原理计算 $\phi(30)$

**解答**:
$30 = 2 \times 3 \times 5$，设 $A_p$ 为被$p$整除的数集（$p \in \{2,3,5\}$）

$$|A_2| = 15, \quad |A_3| = 10, \quad |A_5| = 6$$
$$|A_2 \cap A_3| = 5, \quad |A_2 \cap A_5| = 3, \quad |A_3 \cap A_5| = 2$$
$$|A_2 \cap A_3 \cap A_5| = 1$$

$$|A_2 \cup A_3 \cup A_5| = 15+10+6-5-3-2+1 = 22$$

$$\phi(30) = 30 - 22 = 8$$

验证：$\phi(30) = 30(1-\frac{1}{2})(1-\frac{1}{3})(1-\frac{1}{5}) = 30 \times \frac{1}{2} \times \frac{2}{3} \times \frac{4}{5} = 8$ ✓

**答案**: $\boxed{8}$

---

## 156. 两集合并集
**题目**: 集合$|A| = 15$，$|B| = 20$，$|A \cap B| = 8$，求$|A \cup B|$

**解答**:
由两集合容斥原理：
$$|A \cup B| = |A| + |B| - |A \cap B| = 15 + 20 - 8 = 27$$

**答案**: $\boxed{27}$

---

## 157. 容斥求交集
**题目**: 已知$|A \cup B| = 50$，$|A| = 30$，$|B| = 35$，求$|A \cap B|$

**解答**:
由 $|A \cup B| = |A| + |B| - |A \cap B|$

$$50 = 30 + 35 - |A \cap B|$$

$$|A \cap B| = 65 - 50 = 15$$

**答案**: $\boxed{15}$

---

## 158. 文氏图计数
**题目**: 某校选修课中，选数学的有45人，选物理的有38人，两科都选的有20人，只选一科的有多少人？

**解答**:
$$|A \cup B| = 45 + 38 - 20 = 63$$

只选数学的：$45 - 20 = 25$
只选物理的：$38 - 20 = 18$

只选一科的：$25 + 18 = 43$

**答案**: $\boxed{43}$

---

## 159. 容斥原理逆用
**题目**: 在1到200中，能被4整除但不能被6整除的数有多少个？

**解答**:
能被4整除的数：$\left\lfloor\frac{200}{4}\right\rfloor = 50$

能被4和6同时整除（即被12整除）的数：$\left\lfloor\frac{200}{12}\right\rfloor = 16$

能被4整除但不能被6整除的数：$50 - 16 = 34$

**答案**: $\boxed{34}$

---

## 160. 容斥基础练习
**题目**: 求1到120中与6互质的整数个数

**解答**:
$6 = 2 \times 3$，用容斥原理

被2整除的：60个，被3整除的：40个，被6整除的：20个

被2或3整除的：$60 + 40 - 20 = 80$

与6互质的：$120 - 80 = 40$

**答案**: $\boxed{40}$

---

## 161. 两个集合的容斥（进阶）
**题目**: 某公司有100名员工，会说英语的有65人，会说法语的有45人，两种语言都不会说的有15人。求两种语言都会说的有多少人？

**解答**:
至少会说一种语言的：$100 - 15 = 85$ 人

设两种都会的为$x$人

$$65 + 45 - x = 85$$
$$110 - x = 85$$
$$x = 25$$

**答案**: $\boxed{25}$

---

## 162. 集合差集计数
**题目**: $|A| = 40$，$|B| = 35$，$|A \cap B| = 15$，求$|A - B|$

**解答**:
$$|A - B| = |A| - |A \cap B| = 40 - 15 = 25$$

**答案**: $\boxed{25}$

---

## 163. 对称差计数
**题目**: 集合$A$和$B$满足$|A| = 20$，$|B| = 25$，$|A \cap B| = 8$，求对称差$|A \triangle B|$

**解答**:
$$A \triangle B = (A - B) \cup (B - A)$$
$$|A \triangle B| = |A - B| + |B - A|$$
$$= (|A| - |A \cap B|) + (|B| - |A \cap B|)$$
$$= (20 - 8) + (25 - 8) = 12 + 17 = 29$$

**答案**: $\boxed{29}$

---

## 164. 容斥求补集交集
**题目**: 全集$|U| = 100$，$|A| = 60$，$|B| = 45$，$|A \cap B| = 25$，求$|\overline{A} \cap \overline{B}|$

**解答**:
$$|A \cup B| = 60 + 45 - 25 = 80$$

由德摩根律：
$$|\overline{A} \cap \overline{B}| = |\overline{A \cup B}| = 100 - 80 = 20$$

**答案**: $\boxed{20}$

---

## 165. 容斥实际应用
**题目**: 某调查显示，喜欢咖啡的有72人，喜欢茶的有58人，两种都喜欢的是两种都不喜欢的2倍。若调查总人数为100人，求两种都不喜欢的人数

**解答**:
设两种都不喜欢的为$x$人，则两种都喜欢的为$2x$人

至少喜欢一种的：$100 - x$ 人

由容斥：$72 + 58 - 2x = 100 - x$
$$130 - 2x = 100 - x$$
$$30 = x$$

所以两种都不喜欢的有30人

**答案**: $\boxed{30}$

---

## 166. 整数计数问题
**题目**: 求1到500中能被2或7整除但不能被14整除的整数个数

**解答**:
$$|A_2| = 250, \quad |A_7| = 71, \quad |A_{14}| = 35$$

能被2或7整除的：$|A_2 \cup A_7| = 250 + 71 - 35 = 286$

能被14整除的就是$|A_2 \cap A_7| = 35$

能被2或7整除但不能被14整除的：$286 - 35 = 251$

**答案**: $\boxed{251}$

---

## 167. 容斥与概率
**题目**: 掷一枚公平骰子两次，求至少出现一次6点的概率

**解答**:
用容斥原理，设$A$为第一次6点，$B$为第二次6点

$$P(A) = P(B) = \frac{1}{6}, \quad P(A \cap B) = \frac{1}{36}$$

$$P(A \cup B) = \frac{1}{6} + \frac{1}{6} - \frac{1}{36} = \frac{6+6-1}{36} = \frac{11}{36}$$

或用补集：$1 - (\frac{5}{6})^2 = 1 - \frac{25}{36} = \frac{11}{36}$

**答案**: $\boxed{\dfrac{11}{36}}$

---

## 168. 集合覆盖问题
**题目**: 三个集合满足$|A_1| = |A_2| = |A_3| = 20$，$|A_1 \cap A_2| = |A_2 \cap A_3| = |A_3 \cap A_1| = 10$，$|A_1 \cap A_2 \cap A_3| = 5$，求$|A_1 \cup A_2 \cup A_3|$

**解答**:
由三集合容斥原理：
$$|A_1 \cup A_2 \cup A_3| = \sum|A_i| - \sum|A_i \cap A_j| + |A_1 \cap A_2 \cap A_3|$$
$$= 3 \times 20 - 3 \times 10 + 5 = 60 - 30 + 5 = 35$$

**答案**: $\boxed{35}$

---

## 169. 容斥与倍数
**题目**: 求1到200中能被3整除或能被4整除且是偶数的数的个数

**解答**:
能被3整除的：$\left\lfloor\frac{200}{3}\right\rfloor = 66$
能被4整除（即偶数且被4整除）的：$\left\lfloor\frac{200}{4}\right\rfloor = 50$
能被12整除的：$\left\lfloor\frac{200}{12}\right\rfloor = 16$

答案：$66 + 50 - 16 = 100$

**答案**: $\boxed{100}$

---

## 170. 复杂两集合问题
**题目**: 某图书馆有科技书和文学书共200本。借出科技书的一半和文学书的60本后，剩余两书数量相等。若原来科技书有120本，求剩余总数

**解答**:
设科技书120本，文学书$200 - 120 = 80$本

借出科技书：$120 \times \frac{1}{2} = 60$本，剩余60本
借出文学书：60本，剩余$80 - 60 = 20$本

两书剩余不相等，题目条件需满足：$\frac{120}{2} = 80 - 60 = 20$？不成立

重新理解：设科技书$x$本，文学书$y$本，$x + y = 200$

$\frac{x}{2} = y - 60$，即$x = 2y - 120$

$2y - 120 + y = 200$，$3y = 320$，$y = \frac{320}{3}$ 非整数

假设借出科技书一半（60本），文学书借出使剩余相等：$120/2 = 60 = y - \text{借出}$，文学书应有80本，借出20本

剩余总数：$60 + 60 = 120$

**答案**: $\boxed{120}$

---

## 171. 三个集合容斥基础
**题目**: 设$|A| = 30$，$|B| = 35$，$|C| = 40$，$|A \cap B| = 15$，$|B \cap C| = 18$，$|C \cap A| = 12$，$|A \cap B \cap C| = 8$，求$|A \cup B \cup C|$

**解答**:
由三集合容斥原理：
$$|A \cup B \cup C| = |A| + |B| + |C| - |A \cap B| - |B \cap C| - |C \cap A| + |A \cap B \cap C|$$
$$= 30 + 35 + 40 - 15 - 18 - 12 + 8 = 105 - 45 + 8 = 68$$

**答案**: $\boxed{68}$

---

## 172. 三集合容斥求交集
**题目**: 已知$|A \cup B \cup C| = 80$，$|A| = |B| = |C| = 40$，$|A \cap B| = |B \cap C| = |C \cap A| = 20$，求$|A \cap B \cap C|$

**解答**:
设$|A \cap B \cap C| = x$

$$80 = 3 \times 40 - 3 \times 20 + x$$
$$80 = 120 - 60 + x$$
$$80 = 60 + x$$
$$x = 20$$

**答案**: $\boxed{20}$

---

## 173. 三集合实际问题
**题目**: 某班50名学生，参加数学竞赛的有30人，物理竞赛的有25人，化学竞赛的有20人。同时参加数学和物理的有12人，物理和化学的有10人，化学和数学的有8人，三项都参加的有5人。求至少参加一项竞赛的人数

**解答**:
$$|M \cup P \cup C| = 30 + 25 + 20 - 12 - 10 - 8 + 5 = 75 - 30 + 5 = 50$$

恰好等于全班人数，说明所有学生都至少参加一项竞赛

**答案**: $\boxed{50}$

---

## 174. 三集合精确计数
**题目**: 在上述173题中，求只参加一项竞赛的人数

**解答**:
只参加数学的：$30 - (12 - 5) - (8 - 5) - 5 = 30 - 7 - 3 - 5 = 15$
只参加物理的：$25 - (12 - 5) - (10 - 5) - 5 = 25 - 7 - 5 - 5 = 8$
只参加化学的：$20 - (10 - 5) - (8 - 5) - 5 = 20 - 5 - 3 - 5 = 7$

只参加一项的：$15 + 8 + 7 = 30$

**答案**: $\boxed{30}$

---

## 175. 三集合恰好两项
**题目**: 在173题的条件下，求恰好参加两项竞赛的人数

**解答**:
恰好参加数学和物理的：$12 - 5 = 7$
恰好参加物理和化学的：$10 - 5 = 5$
恰好参加化学和数学的：$8 - 5 = 3$

恰好参加两项的：$7 + 5 + 3 = 15$

验证：只一项(30) + 恰两项(15) + 三项(5) = 50 ✓

**答案**: $\boxed{15}$

---

## 176. 三集合文氏图
**题目**: 全集$|U| = 100$，三个子集满足$|A| = 50$，$|B| = 40$，$|C| = 35$，两两交集均为20，三交集为10。求不在任何集合中的元素个数

**解答**:
$$|A \cup B \cup C| = 50 + 40 + 35 - 20 - 20 - 20 + 10 = 125 - 60 + 10 = 75$$

不在任何集合中的：$100 - 75 = 25$

**答案**: $\boxed{25}$

---

## 177. 容斥求仅一集合
**题目**: $|A| = 40$，$|B| = 35$，$|C| = 30$，$|A \cap B| = 15$，$|B \cap C| = 12$，$|C \cap A| = 10$，$|A \cap B \cap C| = 5$。求仅在$A$中不在$B$或$C$中的元素个数

**解答**:
仅在$A$中的 = $|A| - |A \cap B| - |A \cap C| + |A \cap B \cap C|$
$$= 40 - 15 - 10 + 5 = 20$$

或：仅在$A$中的 = $|A| - ($恰在$A \cap B$的$) - ($恰在$A \cap C$的$) - ($三交集的$)$
恰在$A \cap B$的 = $15 - 5 = 10$
恰在$A \cap C$的 = $10 - 5 = 5$
仅在$A$的 = $40 - 10 - 5 - 5 = 20$

**答案**: $\boxed{20}$

---

## 178. 三个质数倍数
**题目**: 求1到300中能被2、3或5整除的整数个数

**解答**:
$$|A_2| = 150, \quad |A_3| = 100, \quad |A_5| = 60$$
$$|A_6| = 50, \quad |A_{10}| = 30, \quad |A_{15}| = 20$$
$$|A_{30}| = 10$$

$$|A_2 \cup A_3 \cup A_5| = 150 + 100 + 60 - 50 - 30 - 20 + 10 = 310 - 100 + 10 = 220$$

**答案**: $\boxed{220}$

---

## 179. 容斥与欧拉函数
**题目**: 用容斥原理计算1到60中与60互质的整数个数

**解答**:
$60 = 2^2 \times 3 \times 5$

$$\phi(60) = 60\left(1-\frac{1}{2}\right)\left(1-\frac{1}{3}\right)\left(1-\frac{1}{5}\right) = 60 \times \frac{1}{2} \times \frac{2}{3} \times \frac{4}{5} = 16$$

用容斥：被2、3或5整除的数
$$= 30 + 20 + 12 - 10 - 6 - 4 + 2 = 62 - 20 + 2 = 44$$

与60互质的：$60 - 44 = 16$

**答案**: $\boxed{16}$

---

## 180. 三集合补集
**题目**: 全集$|U| = 200$，$|A| = 80$，$|B| = 70$，$|C| = 60$，$|A \cap B| = 30$，$|B \cap C| = 25$，$|C \cap A| = 20$，$|A \cap B \cap C| = 10$。求$|\overline{A} \cap \overline{B} \cap \overline{C}|$

**解答**:
$$|A \cup B \cup C| = 80 + 70 + 60 - 30 - 25 - 20 + 10 = 210 - 75 + 10 = 145$$

$$|\overline{A} \cap \overline{B} \cap \overline{C}| = |\overline{A \cup B \cup C}| = 200 - 145 = 55$$

**答案**: $\boxed{55}$

---

## 181. 容斥原理推广
**题目**: 用容斥原理求$\left|\bigcup_{i=1}^{n} A_i\right|$的公式

**解答**:
$$\left|\bigcup_{i=1}^{n} A_i\right| = \sum_{i}|A_i| - \sum_{i<j}|A_i \cap A_j| + \sum_{i<j<k}|A_i \cap A_j \cap A_k| - \cdots + (-1)^{n+1}|A_1 \cap \cdots \cap A_n|$$

$$= \sum_{k=1}^{n}(-1)^{k+1}\sum_{1 \leq i_1 < \cdots < i_k \leq n}|A_{i_1} \cap \cdots \cap A_{i_k}|$$

**答案**: $\boxed{\displaystyle\left|\bigcup_{i=1}^{n} A_i\right| = \sum_{k=1}^{n}(-1)^{k+1}\sum_{1 \leq i_1 < \cdots < i_k \leq n}|A_{i_1} \cap \cdots \cap A_{i_k}|}$

---

## 182. 错位排列基础
**题目**: 求4个元素的错位排列数$D_4$

**解答**:
错位排列数公式：
$$D_n = n!\sum_{k=0}^{n}\frac{(-1)^k}{k!} = n!\left(1 - 1 + \frac{1}{2!} - \frac{1}{3!} + \cdots + \frac{(-1)^n}{n!}\right)$$

或用容斥：$D_n = n! - C_n^1(n-1)! + C_n^2(n-2)! - \cdots + (-1)^n C_n^n 0!$

$$D_4 = 4!\left(\frac{1}{2!} - \frac{1}{3!} + \frac{1}{4!}\right) = 24\left(\frac{1}{2} - \frac{1}{6} + \frac{1}{24}\right) = 12 - 4 + 1 = 9$$

**答案**: $\boxed{9}$

---

## 183. 错位排列计算
**题目**: 计算$D_5$（5个元素的错位排列数）

**解答**:
$$D_5 = 5!\left(\frac{1}{2!} - \frac{1}{3!} + \frac{1}{4!} - \frac{1}{5!}\right)$$
$$= 120\left(\frac{1}{2} - \frac{1}{6} + \frac{1}{24} - \frac{1}{120}\right)$$
$$= 60 - 20 + 5 - 1 = 44$$

或用递推：$D_n = (n-1)(D_{n-1} + D_{n-2})$，$D_1 = 0, D_2 = 1$
$D_3 = 2(1+0) = 2$，$D_4 = 3(2+1) = 9$，$D_5 = 4(9+2) = 44$

**答案**: $\boxed{44}$

---

## 184. 部分错位排列
**题目**: 将6封信装入6个信封，恰好有2封装对的装法有多少种？

**解答**:
先选2封装对：$C_6^2 = 15$种

其余4封必须全部装错（错位排列）：$D_4 = 9$

总装法：$15 \times 9 = 135$

**答案**: $\boxed{135}$

---

## 185. 错位排列近似
**题目**: 证明当$n$很大时，$D_n \approx \dfrac{n!}{e}$，并计算$D_{10}$

**解答**:
$$D_n = n!\sum_{k=0}^{n}\frac{(-1)^k}{k!} = n!\left(e^{-1} - R_n\right)$$

其中$R_n = \sum_{k=n+1}^{\infty}\frac{(-1)^k}{k!}$很小，所以$D_n \approx \dfrac{n!}{e}$

$$D_{10} = 10!\left(\frac{1}{2!} - \frac{1}{3!} + \cdots - \frac{1}{10!}\right) = 1334961$$

或由$D_n = \left\lfloor\frac{n!}{e} + \frac{1}{2}\right\rfloor$：$\frac{10!}{e} \approx 1334960.9$，取整得$1334961$

**答案**: $\boxed{1334961}$

---

## 186. 错位排列递推
**题目**: 用递推公式证明$D_n = nD_{n-1} + (-1)^n$

**解答**:
已知递推：$D_n = (n-1)(D_{n-1} + D_{n-2})$

展开：$D_n = (n-1)D_{n-1} + (n-1)D_{n-2}$

又$D_{n-1} = (n-2)(D_{n-2} + D_{n-3})$，所以$(n-1)D_{n-2} = D_{n-1} - (n-2)D_{n-3}$

直接证明：
$$nD_{n-1} + (-1)^n = n(n-1)!\sum_{k=0}^{n-1}\frac{(-1)^k}{k!} + (-1)^n$$
$$= n!\sum_{k=0}^{n-1}\frac{(-1)^k}{k!} + n!\frac{(-1)^n}{n!}$$
$$= n!\sum_{k=0}^{n}\frac{(-1)^k}{k!} = D_n$$

**答案**: $\boxed{D_n = nD_{n-1} + (-1)^n \text{ 成立}}$

---

## 187. 错排问题应用
**题目**: 4个人互换礼物，每人不拿到自己原来的礼物，有多少种换法？

**解答**:
这正是4个元素的错位排列问题

$$D_4 = 9$$

列举：设4人为A,B,C,D，原礼物为a,b,c,d

所有排列共24种，减去有人拿到自己礼物的
用容斥：$24 - C_4^1 \cdot 6 + C_4^2 \cdot 2 - C_4^3 \cdot 1 + C_4^4 \cdot 1 = 24 - 24 + 12 - 4 + 1 = 9$

**答案**: $\boxed{9}$

---

## 188. 至少一错排
**题目**: 5封信随机装入5个信封，至少有一封装错的概率是多少？

**解答**:
全对只有1种，总排列$5! = 120$

至少一错 = $120 - 1 = 119$种

概率 = $\frac{119}{120}$

或理解为：不是全对 = $1 - \frac{1}{120} = \frac{119}{120}$

**答案**: $\boxed{\dfrac{119}{120}}$

---

## 189. 混合错排
**题目**: 6个人围坐圆桌吃饭，求没有人坐在原来位置的坐法数（圆排列错排）

**解答**:
圆排列总数：$(6-1)! = 120$

用容斥原理计算圆错排$Q_n$：

$$Q_n = (n-1)! - C_n^1(n-2)! + C_n^2(n-3)! - \cdots$$

$$Q_6 = 5! - C_6^1 \cdot 4! + C_6^2 \cdot 3! - C_6^3 \cdot 2! + C_6^4 \cdot 1! - C_6^5 \cdot 0! + C_6^6 \cdot (-1)$$

实际上对于圆错排有复杂公式，简单计算：

用标准错排：$D_6 = 265$，考虑旋转等价较复杂

若按直线错排理解：$D_6 = 265$

**答案**: $\boxed{265}$ (直线错排)

---

## 190. 错排计数公式
**题目**: 计算$D_3$并列举所有3元素的错位排列

**解答**:
$$D_3 = 3!\left(\frac{1}{2!} - \frac{1}{3!}\right) = 6 \times \frac{1}{3} = 2$$

列举：元素$(1,2,3)$的排列
- $(2,3,1)$：1→2, 2→3, 3→1，无固定点 ✓
- $(3,1,2)$：1→3, 2→1, 3→2，无固定点 ✓

其他排列都有固定点

**答案**: $\boxed{2}$，排列为$(2,3,1)$和$(3,1,2)$

---

## 191. 素数计数基础
**题目**: 用容斥原理计算$\pi(30)$（不超过30的素数个数）

**解答**:
筛去合数：被2、3、5整除的数（$\sqrt{30} < 6$）

1到30中：
- 被2整除：15个
- 被3整除：10个
- 被5整除：6个
- 被6整除：5个
- 被10整除：3个
- 被15整除：2个
- 被30整除：1个

被2、3或5整除的数：$15 + 10 + 6 - 5 - 3 - 2 + 1 = 22$

除去1：素数 = $30 - 22 - 1 = 7$（不包括1）

素数为：2, 3, 5, 7, 11, 13, 17, 19, 23, 29 共10个

重新算：$\sqrt{30} \approx 5.47$，只需考虑2,3,5

被2、3、5整除的数有22个，包括2,3,5本身

素数个数 = （总数 - 1 - 合数个数）
合数 = 被2、3、5整除且大于5的数 = $22 - 3 = 19$（减去2,3,5）

不对，容斥计算的是被2或3或5整除的数，包括素数2,3,5

素数个数 = 被2或3或5整除的数中本身是素数的 + 不被2,3,5整除的数中素数

直接：1 + （不被2,3,5整除的数）= $1 + (30 - 22) = 9$，还需加上2,3,5这3个
不对，1不是素数

正确：素数 = {不被2,3,5整除的数（除去1）} $\cup$ {2,3,5}

不被2,3,5整除的数有8个：1, 7, 11, 13, 17, 19, 23, 29
除去1，有7个素数
加上2,3,5，共10个素数

**答案**: $\boxed{10}$

---

## 192. 素数计数函数
**题目**: 计算$\pi(50)$（不超过50的素数个数）

**解答**:
$\sqrt{50} \approx 7.07$，考虑素数2, 3, 5, 7

用容斥计算被2,3,5,7整除的数：

$$|A_2| = 25, |A_3| = 16, |A_5| = 10, |A_7| = 7$$
$$|A_6| = 8, |A_{10}| = 5, |A_{14}| = 3, |A_{15}| = 3, |A_{21}| = 2, |A_{35}| = 1$$
$$|A_{30}| = 1, |A_{42}| = 1, |A_{70}| = 0, |A_{105}| = 0$$
$$|A_{210}| = 0$$

两两交集和：$8+5+3+3+2+1 = 22$
三三交集：$|A_{30}|+|A_{42}|+|A_{70}|+|A_{105}| = 1+1+0+0 = 2$
四交集：0

被2,3,5或7整除的数：$25+16+10+7 - 22 + 2 - 0 = 58 - 22 + 2 = 38$

不被2,3,5,7整除的数：$50 - 38 = 12$个

这些数（除去1）加上2,3,5,7：

不被整除的数：1, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47（除去1有11个）

素数共：$11 + 4 = 15$个

**答案**: $\boxed{15}$

---

## 193. 容斥筛素数
**题目**: 用埃拉托斯特尼筛法思想结合容斥，求1到100中的素数个数

**解答**:
$\sqrt{100} = 10$，考虑素数2, 3, 5, 7

被2,3,5,7整除的数：

$|A_2|=50, |A_3|=33, |A_5|=20, |A_7|=14$，和=117

两两：$|A_6|=16, |A_{10}|=10, |A_{14}|=7, |A_{15}|=6, |A_{21}|=4, |A_{35}|=2$，和=45

三三：$|A_{30}|=3, |A_{42}|=2, |A_{70}|=1, |A_{105}|=0$，和=6

四四：$|A_{210}|=0$

被2,3,5,7整除的数：$117 - 45 + 6 - 0 = 78$

不被2,3,5,7整除的数：$100 - 78 = 22$个

除去1，有21个素数候选，加上2,3,5,7这4个，共25个素数

**答案**: $\boxed{25}$

---

## 194. 孪生素数计数
**题目**: 求1到50中有多少对孪生素数（差为2的素数对）

**解答**:
1到50中的素数：2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47

孪生素数对：
- (3, 5)
- (5, 7)
- (11, 13)
- (17, 19)
- (29, 31)
- (41, 43)

共6对

**答案**: $\boxed{6}$

---

## 195. 素数密度
**题目**: 估计$\pi(1000)$并验证

**解答**:
由素数定理：$\pi(x) \approx \dfrac{x}{\ln x}$

$$\pi(1000) \approx \frac{1000}{\ln 1000} = \frac{1000}{6.907} \approx 145$$

实际值：$\pi(1000) = 168$

更精确的估计：$\pi(x) \approx \text{Li}(x) = \int_2^x \frac{dt}{\ln t}$

**答案**: $\boxed{168}$ (实际值)，估计约145

---

## 196. 容斥与平方自由数
**题目**: 求1到100中是平方自由数（不被任何大于1的完全平方数整除）的个数

**解答**:
考虑被$4, 9, 25, 49$整除的数（$2^2, 3^2, 5^2, 7^2$，$11^2=121>100$）

$|A_4|=25, |A_9|=11, |A_{25}|=4, |A_{49}|=2$

交集：$|A_{36}|=2, |A_{100}|=1, |A_{196}|=0...$

被平方数整除的数：
$$25+11+4+2 - (2+1+0...) + 0 = 42 - 3 = 39$$

平方自由数：$100 - 39 = 61$

**答案**: $\boxed{61}$

---

## 197. 容斥综合应用
**题目**: 求1到120中与120互质的整数个数

**解答**:
$120 = 2^3 \times 3 \times 5$

$$\phi(120) = 120 \times \frac{1}{2} \times \frac{2}{3} \times \frac{4}{5} = 120 \times \frac{8}{30} = 32$$

用容斥：被2,3或5整除的数

$|A_2|=60, |A_3|=40, |A_5|=24$
$|A_6|=20, |A_{10}|=12, |A_{15}|=8$
$|A_{30}|=4$

$|A_2 \cup A_3 \cup A_5| = 60+40+24-20-12-8+4 = 124-40+4 = 88$

与120互质的：$120 - 88 = 32$

**答案**: $\boxed{32}$

---

## 198. 容斥计数进阶
**题目**: 求方程$x_1 + x_2 + x_3 = 15$的正整数解个数，其中$x_1 \leq 8$，$x_2 \leq 7$，$x_3 \leq 6$

**解答**:
无约束正整数解：$C_{14}^2 = 91$

设$A_1$：$x_1 \geq 9$，$A_2$：$x_2 \geq 8$，$A_3$：$x_3 \geq 7$

$|A_1|$：令$y_1 = x_1 - 8 \geq 1$，$y_1 + x_2 + x_3 = 7$，解数$C_6^2 = 15$
$|A_2|$：$x_1 + y_2 + x_3 = 8$，$C_7^2 = 21$
$|A_3|$：$x_1 + x_2 + y_3 = 9$，$C_8^2 = 28$

$|A_1 \cap A_2|$：$y_1 + y_2 + x_3 = 0$，无解，0
$|A_1 \cap A_3|$：$y_1 + x_2 + y_3 = 2$，$C_1^2 = 0$，无解
$|A_2 \cap A_3|$：$x_1 + y_2 + y_3 = 1$，无解，0

三交集也为0

满足约束的解：$91 - 15 - 21 - 28 = 91 - 64 = 27$

**答案**: $\boxed{27}$

---

## 199. 容斥原理总结
**题目**: 用容斥原理证明：$\displaystyle\sum_{k=0}^{n}(-1)^k C_n^k = 0$

**解答**:
考虑全集$U$，$|U| = n$，子集$A \subseteq U$

对任意元素，计数它在所有子集中出现的次数：

由二项式定理：$(1-1)^n = \sum_{k=0}^{n}C_n^k (-1)^k = 0$

或用容斥：考虑空集的计数

**答案**: $\boxed{0}$

---

## 200. 容斥原理综合挑战
**题目**: 求1到200中满足以下条件的整数个数：不被2整除、不被3整除、但能被5整除

**解答**:
设$A$：被2整除，$B$：被3整除，$C$：被5整除

求$|\overline{A} \cap \overline{B} \cap C|$

$$|C| = 40$$
$$|A \cap C| = |A_{10}| = 20$$（被10整除）
$$|B \cap C| = |A_{15}| = 13$$（被15整除）
$$|A \cap B \cap C| = |A_{30}| = 6$$（被30整除）

$|A \cap C \cup B \cap C| = |A_{10} \cup A_{15}| = 20 + 13 - 6 = 27$

被5整除且被2或3整除的数：27个

被5整除但不被2且不被3整除的数：$40 - 27 = 13$

验证：被5整除的数中，末位为5且不被3整除的
5, 25, 35, 55, 65, 85, 95, 115, 125, 145, 155, 175, 185, 195

检查：195 = 3 × 65，被3整除，排除
实际：5, 25, 35, 55, 65, 85, 95, 115, 125, 145, 155, 175, 185（13个）✓

**答案**: $\boxed{13}$

---

# 容斥原理公式总结

## 基本公式

**两集合容斥**:
$$|A \cup B| = |A| + |B| - |A \cap B|$$

**三集合容斥**:
$$|A \cup B \cup C| = |A| + |B| + |C| - |A \cap B| - |B \cap C| - |C \cap A| + |A \cap B \cap C|$$

**一般容斥原理**:
$$\left|\bigcup_{i=1}^{n} A_i\right| = \sum_{k=1}^{n}(-1)^{k+1}\sum_{1 \leq i_1 < \cdots < i_k \leq n}|A_{i_1} \cap \cdots \cap A_{i_k}|$$

## 特殊应用

**错位排列**:
$$D_n = n!\sum_{k=0}^{n}\frac{(-1)^k}{k!} = \left\lfloor\frac{n!}{e} + \frac{1}{2}\right\rfloor$$

**欧拉函数**:
$$\phi(n) = n\prod_{p|n}\left(1-\frac{1}{p}\right)$$

**素数计数**（容斥筛法）:
$$\pi(n) = (n-1) - \left|\bigcup_{p \leq \sqrt{n}} A_p\right| + |\{p : p \leq \sqrt{n}\}|$$

其中$A_p$表示被素数$p$整除的数集。

---

*本卷完*
